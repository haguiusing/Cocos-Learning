{"version":3,"sources":["file:///G:/CocosProjects/Cocos-Learning/assets/Scripts/Cocos%E6%A0%B8%E5%BF%83/2D%20%E5%AF%B9%E8%B1%A1/2D%20%E6%B8%B2%E6%9F%93/Lesson27_TiledMap.ts"],"names":["_decorator","Component","TiledMap","resources","log","TiledMapAsset","ccclass","property","Lesson27_TiledMap","loadTiledMap","path","load","err","asset","tiledMap","tmxAsset","inspectMap","mapSize","getMapSize","tileSize","getTileSize","listLayers","layers","getLayers","forEach","layer","getLayerName","listObjectGroups","groups","getObjectGroups","group","getGroupName","readProperties","mapProps","getProperties","gidProps","getPropertiesForGID","prop","getProperty","fixSeams","enableTexelOffset","getLayerByName","name","getLayer","start"],"mappings":"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","sourcesContent":["// Lesson27_.ts\nimport { _decorator, Component, TiledMap, Size, resources, log, TiledMapAsset } from 'cc';\nconst { ccclass, property } = _decorator;\n\n/**\n * TiledMap（TMX 瓦片地图）API 全功能演示\n * 核心类：Lesson27_TiledMap\n */\n@ccclass('Lesson27_TiledMap')\nexport class Lesson27_TiledMap extends Component {\n\n    /* ------------------ 1. 组件声明 ------------------ */\n    //#region 1. 组件声明\n    @property(TiledMap)\n    tiledMap: TiledMap = null!;\n    //#endregion\n\n    /* ------------------ 2. 加载 TMX 资源 ------------------ */\n    //#region 2. 加载资源\n    private loadTiledMap(path: string) {\n        resources.load<TiledMapAsset>(path, TiledMapAsset, (err, asset) => {\n            if (err) { log('加载失败:', err); return; }\n            this.tiledMap.tmxAsset = asset;\n            this.inspectMap();\n        });\n    }\n    //#endregion\n\n    /* ------------------ 3. 地图基本信息 ------------------ */\n    //#region 3. 基本信息\n    private inspectMap() {\n        const mapSize = this.tiledMap.getMapSize();\n        const tileSize = this.tiledMap.getTileSize();\n        log('地图大小:', mapSize);\n        log('瓦片尺寸:', tileSize);\n    }\n    //#endregion\n\n    /* ------------------ 4. 获取所有层 ------------------ */\n    //#region 4. 层遍历\n    private listLayers() {\n        const layers = this.tiledMap.getLayers();\n        layers.forEach(layer => log('Layer:', layer.getLayerName()));\n    }\n    //#endregion\n\n    /* ------------------ 5. 获取对象层 ------------------ */\n    //#region 5. 对象层\n    private listObjectGroups() {\n        const groups = this.tiledMap.getObjectGroups();\n        groups.forEach(group => log('ObjectGroup:', group.getGroupName()));\n    }\n    //#endregion\n\n    /* ------------------ 6. 自定义属性 ------------------ */\n    //#region 6. 属性读取\n    private readProperties() {\n        // 地图级属性\n        const mapProps = this.tiledMap.getProperties();\n        log('Map props:', mapProps);\n\n        // 指定 GID 的属性\n        const gidProps = this.tiledMap.getPropertiesForGID(1);\n        log('GID=1 props:', gidProps);\n\n        // 指定名称的全局属性\n        const prop = this.tiledMap.getProperty('bgm');\n        log('bgm property:', prop);\n    }\n    //#endregion\n\n    /* ------------------ 7. 像素偏移修正 ------------------ */\n    //#region 7. 黑线修复\n    private fixSeams() {\n        this.tiledMap.enableTexelOffset(true); // 开启 0.5 像素偏移\n    }\n    //#endregion\n\n    /* ------------------ 8. 动态切换层 ------------------ */\n    //#region 8. 动态层\n    private getLayerByName(name: string) {\n        const layer = this.tiledMap.getLayer(name);\n        if (layer) log(`层 ${name} 存在`);\n        return layer;\n    }\n    //#endregion\n\n    /* ------------------ 9. 生命周期 ------------------ */\n    //#region Lifecycle\n    protected start() {\n        if (!this.tiledMap) return;\n        this.fixSeams();\n        this.listLayers();\n        this.listObjectGroups();\n        this.readProperties();\n\n        // 如果没有在编辑器绑定，可动态加载\n        if (!this.tiledMap.tmxAsset) {\n            this.loadTiledMap('maps/level1');\n        }\n    }\n    //#endregion\n}"]}