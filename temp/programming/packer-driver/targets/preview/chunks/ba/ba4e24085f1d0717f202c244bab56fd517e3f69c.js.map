{"version":3,"sources":["file:///G:/CocosProjects/Cocos-Learning/assets/Scripts/Cocos%E6%A0%B8%E5%BF%83/2D%20%E5%AF%B9%E8%B1%A1/2D%20%E6%B8%B2%E6%9F%93/Lesson27_.ts"],"names":["_decorator","Component","TiledMap","resources","log","TiledMapAsset","ccclass","property","Lesson27_","loadTiledMap","path","load","err","asset","tiledMap","tmxAsset","inspectMap","mapSize","getMapSize","tileSize","getTileSize","listLayers","layers","getLayers","forEach","layer","getLayerName","listObjectGroups","groups","getObjectGroups","group","getGroupName","readProperties","mapProps","getProperties","gidProps","getPropertiesForGID","prop","getProperty","fixSeams","enableTexelOffset","getLayerByName","name","getLayer","start"],"mappings":"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","sourcesContent":["// Lesson27_.ts\r\nimport { _decorator, Component, TiledMap, Size, resources, log, TiledMapAsset } from 'cc';\r\nconst { ccclass, property } = _decorator;\r\n\r\n/**\r\n * TiledMap（TMX 瓦片地图）API 全功能演示\r\n * 核心类：Lesson27_\r\n */\r\n@ccclass('Lesson27_')\r\nexport class Lesson27_ extends Component {\r\n\r\n    /* ------------------ 1. 组件声明 ------------------ */\r\n    //#region 1. 组件声明\r\n    @property(TiledMap)\r\n    tiledMap: TiledMap = null!;\r\n    //#endregion\r\n\r\n    /* ------------------ 2. 加载 TMX 资源 ------------------ */\r\n    //#region 2. 加载资源\r\n    private loadTiledMap(path: string) {\r\n        resources.load<TiledMapAsset>(path, TiledMapAsset, (err, asset) => {\r\n            if (err) { log('加载失败:', err); return; }\r\n            this.tiledMap.tmxAsset = asset;\r\n            this.inspectMap();\r\n        });\r\n    }\r\n    //#endregion\r\n\r\n    /* ------------------ 3. 地图基本信息 ------------------ */\r\n    //#region 3. 基本信息\r\n    private inspectMap() {\r\n        const mapSize = this.tiledMap.getMapSize();\r\n        const tileSize = this.tiledMap.getTileSize();\r\n        log('地图大小:', mapSize);\r\n        log('瓦片尺寸:', tileSize);\r\n    }\r\n    //#endregion\r\n\r\n    /* ------------------ 4. 获取所有层 ------------------ */\r\n    //#region 4. 层遍历\r\n    private listLayers() {\r\n        const layers = this.tiledMap.getLayers();\r\n        layers.forEach(layer => log('Layer:', layer.getLayerName()));\r\n    }\r\n    //#endregion\r\n\r\n    /* ------------------ 5. 获取对象层 ------------------ */\r\n    //#region 5. 对象层\r\n    private listObjectGroups() {\r\n        const groups = this.tiledMap.getObjectGroups();\r\n        groups.forEach(group => log('ObjectGroup:', group.getGroupName()));\r\n    }\r\n    //#endregion\r\n\r\n    /* ------------------ 6. 自定义属性 ------------------ */\r\n    //#region 6. 属性读取\r\n    private readProperties() {\r\n        // 地图级属性\r\n        const mapProps = this.tiledMap.getProperties();\r\n        log('Map props:', mapProps);\r\n\r\n        // 指定 GID 的属性\r\n        const gidProps = this.tiledMap.getPropertiesForGID(1);\r\n        log('GID=1 props:', gidProps);\r\n\r\n        // 指定名称的全局属性\r\n        const prop = this.tiledMap.getProperty('bgm');\r\n        log('bgm property:', prop);\r\n    }\r\n    //#endregion\r\n\r\n    /* ------------------ 7. 像素偏移修正 ------------------ */\r\n    //#region 7. 黑线修复\r\n    private fixSeams() {\r\n        this.tiledMap.enableTexelOffset(true); // 开启 0.5 像素偏移\r\n    }\r\n    //#endregion\r\n\r\n    /* ------------------ 8. 动态切换层 ------------------ */\r\n    //#region 8. 动态层\r\n    private getLayerByName(name: string) {\r\n        const layer = this.tiledMap.getLayer(name);\r\n        if (layer) log(`层 ${name} 存在`);\r\n        return layer;\r\n    }\r\n    //#endregion\r\n\r\n    /* ------------------ 9. 生命周期 ------------------ */\r\n    //#region Lifecycle\r\n    protected start() {\r\n        if (!this.tiledMap) return;\r\n        this.fixSeams();\r\n        this.listLayers();\r\n        this.listObjectGroups();\r\n        this.readProperties();\r\n\r\n        // 如果没有在编辑器绑定，可动态加载\r\n        if (!this.tiledMap.tmxAsset) {\r\n            this.loadTiledMap('maps/level1');\r\n        }\r\n    }\r\n    //#endregion\r\n}"]}